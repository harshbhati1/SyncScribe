// filepath: c:\Users\harsh\OneDrive\Desktop\TwinMind\client\src\components\Dashboard.js
import React, { useEffect, useState } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { authAPI } from '../services/api';
import { useNavigate } from 'react-router-dom';
import {
  Box,
  Typography,
  Button,
  Container,
  Paper,
  CircularProgress,
  Alert,
  Card,
  CardContent,
  Divider,
  AppBar,
  Toolbar,
  Avatar,
  IconButton,
  Tabs,
  Tab,
  List,
  ListItem,
  ListItemText,
  ListItemIcon,
  Badge,
  Stack,
  Menu,
  MenuItem,
  Tooltip,
  Drawer
} from '@mui/material';
import { styled } from '@mui/material/styles';
import LogoutIcon from '@mui/icons-material/Logout';
import MicIcon from '@mui/icons-material/Mic';
import EventNoteIcon from '@mui/icons-material/EventNote';
import SearchIcon from '@mui/icons-material/Search';
import ChatIcon from '@mui/icons-material/Chat';
import CheckCircleIcon from '@mui/icons-material/CheckCircle';
import PeopleIcon from '@mui/icons-material/People';
import MoreVertIcon from '@mui/icons-material/MoreVert';
import HelpOutlineIcon from '@mui/icons-material/HelpOutline';
import StarIcon from '@mui/icons-material/Star';
import AddIcon from '@mui/icons-material/Add';
import ForumIcon from '@mui/icons-material/Forum';
import InfoOutlinedIcon from '@mui/icons-material/InfoOutlined';
import AutorenewIcon from '@mui/icons-material/Autorenew';
import MenuIcon from '@mui/icons-material/Menu';

// Custom styled components to match the ChatGPT-style design
const StyledAppBar = styled(AppBar)(({ theme, sidebarOpen }) => ({
  backgroundColor: theme.palette.background.paper,
  boxShadow: 'none',
  borderBottom: `1px solid ${theme.palette.divider}`,
  color: theme.palette.text.primary,
  position: 'sticky',
  width: sidebarOpen ? 'calc(100% - 280px)' : '100%', 
  marginLeft: sidebarOpen ? '280px' : 0, 
  transition: theme.transitions.create(['width', 'margin-left'], {
    easing: theme.transitions.easing.sharp,
    duration: theme.transitions.duration.enteringScreen,
  }),
}));

const Sidebar = styled(Box)(({ theme }) => ({
  width: '280px',
  height: '100vh',
  position: 'fixed',
  left: 0,
  top: 0,
  backgroundColor: '#f9f9f9',
  borderRight: `1px solid ${theme.palette.divider}`,
  display: 'flex',
  flexDirection: 'column',
  padding: theme.spacing(2),
  overflowY: 'auto',
  transition: theme.transitions.create('transform', {
    easing: theme.transitions.easing.sharp,
    duration: theme.transitions.duration.enteringScreen,
  }),
  zIndex: theme.zIndex.drawer,
}));

const NavSection = styled(Box)(({ theme, scrollable, flexGrow }) => ({
  marginBottom: theme.spacing(2),
  transition: 'max-height 0.3s ease',
  position: 'relative',
  ...(flexGrow && {
    flexGrow: 1,
    display: 'flex',
    flexDirection: 'column',
    overflow: 'hidden',
  }),
  ...(scrollable && {
    maxHeight: flexGrow ? 'none' : 'calc(35vh)',
    overflowY: 'auto',
    paddingRight: theme.spacing(0.5),
    '&::-webkit-scrollbar': {
      width: '4px',
    },
    '&::-webkit-scrollbar-track': {
      background: 'transparent',
    },
    '&::-webkit-scrollbar-thumb': {
      background: '#bdbdbd',
      borderRadius: '4px',
    },
    '&::-webkit-scrollbar-thumb:hover': {
      background: '#9e9e9e',
    }
  })
}));

const TabPanel = styled(Box)(({ theme }) => ({
  padding: theme.spacing(2),
}));

const MeetingCard = styled(Card)(({ theme }) => ({
  marginBottom: theme.spacing(2),
  borderRadius: '12px',
  boxShadow: '0px 2px 8px rgba(0, 0, 0, 0.05)',
  overflow: 'visible',
  transition: 'background-color 0.2s ease',
  '&:hover': {
    backgroundColor: '#f0f0f0',
  }
}));

const MeetingTime = styled(Typography)(({ theme }) => ({
  color: theme.palette.text.secondary,
  fontSize: '0.75rem',
  fontWeight: 500,
}));

const NewChatButton = styled(Button)(({ theme }) => ({
  borderRadius: '8px',
  padding: theme.spacing(1.5, 2),
  fontWeight: 500,
  textTransform: 'none',
  width: '100%',
  justifyContent: 'flex-start',
  border: '1px solid rgba(0, 0, 0, 0.1)',
  backgroundColor: '#ffffff',
  color: theme.palette.text.primary,
  marginBottom: theme.spacing(2),
  '&:hover': {
    backgroundColor: '#f5f5f5',
  },
}));

const NavTitle = styled(Typography)(({ theme }) => ({
  fontSize: '0.75rem',
  fontWeight: 500,
  color: theme.palette.text.secondary,
  textTransform: 'uppercase',
  letterSpacing: '0.5px',
  padding: theme.spacing(1, 1.5),
}));

const NavItem = styled(Button)(({ theme, active }) => ({
  borderRadius: '8px',
  padding: theme.spacing(1, 1.5),
  fontWeight: 400,
  fontSize: '0.9rem',
  textTransform: 'none',
  width: '100%',
  justifyContent: 'flex-start',
  marginBottom: theme.spacing(0.5),
  color: active ? theme.palette.primary.main : theme.palette.text.primary,
  backgroundColor: active ? 'rgba(30, 98, 235, 0.08)' : 'transparent',
  '&:hover': {
    backgroundColor: active ? 'rgba(30, 98, 235, 0.12)' : 'rgba(0, 0, 0, 0.04)',
  },
}));

const CaptureButton = styled(Button)(({ theme }) => ({
  borderRadius: '24px',
  padding: theme.spacing(1, 3),
  fontWeight: 500,
  textTransform: 'none',
  boxShadow: '0px 4px 10px rgba(30, 98, 235, 0.3)',
  '&:hover': {
    boxShadow: '0px 6px 15px rgba(30, 98, 235, 0.4)',
  },
}));

const StyledBadge = styled(Badge)(({ theme }) => ({
  '& .MuiBadge-badge': {
    backgroundColor: '#44b700',
    color: '#44b700',
    boxShadow: `0 0 0 2px ${theme.palette.background.paper}`,
    '&::after': {
      position: 'absolute',
      top: 0,
      left: 0,
      width: '100%',
      height: '100%',
      borderRadius: '50%',
      animation: 'ripple 1.2s infinite ease-in-out',
      border: '1px solid currentColor',
      content: '""',
    },
  },
  '@keyframes ripple': {
    '0%': {
      transform: 'scale(.8)',
      opacity: 1,
    },
    '100%': {
      transform: 'scale(2.4)',
      opacity: 0,
    },
  },
}));

const Dashboard = () => {
  const { currentUser, logOut } = useAuth();
  const navigate = useNavigate();
  const [profileData, setProfileData] = useState(null);  const [error, setError] = useState('');
  const [loading, setLoading] = useState(true);
  const [tabValue, setTabValue] = useState(0);
  const [meetings] = useState([]);
  const [sidebarOpen, setSidebarOpen] = useState(true);
    // Organize meetings by date
  const [favorites, setFavorites] = useState([
    { id: 'fav1', title: 'Weekly standup meeting', date: '2025-05-15' },
    { id: 'fav2', title: 'Product roadmap discussion', date: '2025-05-10' },
    { id: 'fav3', title: 'UX review with design team', date: '2025-05-08' },
    { id: 'fav4', title: 'Quarterly planning session', date: '2025-05-05' },
    { id: 'fav5', title: 'API integration discussion', date: '2025-05-03' },
    { id: 'fav6', title: 'Customer feedback analysis', date: '2025-05-01' },
  ]);
  
  // Group recent meetings by date
  const [recentMeetings, setRecentMeetings] = useState([
    { id: 'recent1', title: 'Marketing strategy review', date: '2025-05-17' },
    { id: 'recent2', title: 'UI/UX feedback session', date: '2025-05-16' },
    { id: 'recent3', title: 'Customer interview notes', date: '2025-05-14' },
  ]);

  const [menuAnchorEl, setMenuAnchorEl] = useState(null);
  const [activeItem, setActiveItem] = useState(null);

  // Function to toggle sidebar
  const toggleSidebar = () => {
    setSidebarOpen(!sidebarOpen);
  };

  const handleTabChange = (event, newValue) => {
    setTabValue(newValue);
  };

  const handleMenuOpen = (event, meeting) => {
    event.stopPropagation();
    setMenuAnchorEl(event.currentTarget);
    setActiveItem(meeting);
  };

  const handleMenuClose = () => {
    setMenuAnchorEl(null);
    setActiveItem(null);
  };  const toggleFavorite = (meeting) => {
    // Check if meeting is already in favorites
    const isFavorite = favorites.some(fav => fav.id === meeting.id);
    
    if (isFavorite) {
      // Remove from favorites
      setFavorites(favorites.filter(fav => fav.id !== meeting.id));
    } else {
      // Add to favorites - no limit now
      setFavorites([...favorites, meeting]);
    }
    
    handleMenuClose();
  };
  // Helper function to format date for display
  const formatDate = (dateString) => {
    const date = new Date(dateString);
    const day = date.getDate();
    const month = date.toLocaleString('default', { month: 'short' });
    const year = date.getFullYear();
    
    // Add ordinal suffix to day
    const ordinal = (d) => {
      if (d > 3 && d < 21) return 'th';
      switch (d % 10) {
        case 1: return 'st';
        case 2: return 'nd';
        case 3: return 'rd';
        default: return 'th';
      }
    };
    
    return `${day}${ordinal(day)} ${month} ${year}`;
  };
  
  // Group meetings by date
  const getMeetingsByDate = (meetings) => {
    const grouped = {};
    meetings.forEach(meeting => {
      const dateString = formatDate(meeting.date);
      if (!grouped[dateString]) {
        grouped[dateString] = [];
      }
      grouped[dateString].push(meeting);
    });
    return grouped;
  };
  
  // Get grouped meetings
  const groupedRecentMeetings = getMeetingsByDate(recentMeetings);

  useEffect(() => {
    // Fetch user profile data to verify authentication works
    const fetchProfileData = async () => {
      try {
        const response = await authAPI.getUserProfile();
        if (response && response.data) {
          setProfileData(response.data);
        }
      } catch (err) {
        console.error('Error fetching profile:', err);
        setError('Failed to fetch profile data');
      } finally {
        setLoading(false);
      }
    };

    fetchProfileData();
  }, []);

  const handleLogout = async () => {
    try {
      await logOut();
      // Redirect happens automatically via auth listener
    } catch (err) {
      console.error('Logout error:', err);
      setError('Failed to log out');
    }
  };
    return (
    <Box sx={{ flexGrow: 1, bgcolor: 'background.default', minHeight: '100vh', display: 'flex' }}>
      {/* Left Sidebar - ChatGPT Style */}
      <Drawer
        variant="persistent"
        anchor="left"
        open={sidebarOpen}
        PaperProps={{
          sx: {
            width: '280px',
            bgcolor: '#f9f9f9',
            border: 'none',
            boxShadow: '1px 0 5px rgba(0,0,0,0.05)'
          }
        }}
      >
        <Sidebar>
          <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
            <Typography 
              variant="h6" 
              component="div" 
              sx={{ 
                fontWeight: 700,
                background: 'linear-gradient(45deg, #1E62EB 30%, #7e57c2 90%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent'
              }}
            >
              TwinMind
            </Typography>
          </Box>
          
          <NewChatButton
            startIcon={<MicIcon />}
            onClick={() => navigate('/transcription')}
          >
            New Meeting
          </NewChatButton>
          
          {/* Sidebar content with Favorites first, then Recent Meetings, and profile at bottom */}
          <Box sx={{ 
            display: 'flex', 
            flexDirection: 'column', 
            height: 'calc(100vh - 170px)'  // Account for header, new chat button, and profile
          }}>
            {/* Favorites section - moved to top */}
            <Box sx={{ mb: 3 }}>
              <NavTitle>Favorites</NavTitle>
              <NavSection 
                scrollable={favorites.length > 5} 
                sx={{ 
                  pb: 1, 
                  maxHeight: 'calc(40vh)',
                  overflowY: 'auto'
                }}
              >
                {favorites.map(fav => (
                  <Box
                    key={fav.id}
                    sx={{ 
                      display: 'flex', 
                      alignItems: 'center', 
                      width: '100%',
                      mb: 0.5,
                    }}
                  >
                    <NavItem 
                      onClick={() => navigate(`/transcription/${fav.id}`)}
                      sx={{ 
                        flexGrow: 1,
                        mb: 0,
                        pr: 1,
                      }}
                    >
                      <Box sx={{ display: 'flex', alignItems: 'center', width: '100%' }}>
                        <StarIcon sx={{ fontSize: 18, mr: 1.5, color: '#F9A825' }} />
                        <Box sx={{ 
                          flexGrow: 1, 
                          overflow: 'hidden', 
                          textOverflow: 'ellipsis', 
                          whiteSpace: 'nowrap'
                        }}>
                          {fav.title}
                        </Box>
                      </Box>
                    </NavItem>
                    <IconButton 
                      size="small" 
                      sx={{ width: 28, height: 28, opacity: 0.6 }}
                      onClick={(e) => handleMenuOpen(e, fav)}
                    >
                      <MoreVertIcon fontSize="small" />
                    </IconButton>
                  </Box>
                ))}
              </NavSection>
            </Box>
            
            {/* Recent meetings section */}
            <Box sx={{ flexGrow: 1, overflow: 'hidden', display: 'flex', flexDirection: 'column' }}>
              <NavTitle>Recent Meetings</NavTitle>
              <Box sx={{ overflowY: 'auto', flexGrow: 1 }}>
                {Object.entries(groupedRecentMeetings).map(([date, meetings]) => (
                  <Box key={date}>
                    <Typography 
                      variant="caption" 
                      sx={{ 
                        display: 'block', 
                        pl: 1.5, 
                        mb: 0.5, 
                        mt: 1.5, 
                        color: 'text.secondary',
                        fontSize: '0.7rem'
                      }}
                    >
                      {date}
                    </Typography>
                    
                    {meetings.map(meeting => (
                      <Box
                        key={meeting.id}
                        sx={{ 
                          display: 'flex', 
                          alignItems: 'center', 
                          width: '100%',
                          mb: 0.5,
                        }}
                      >
                        <NavItem 
                          onClick={() => navigate(`/transcription/${meeting.id}`)}
                          sx={{ 
                            flexGrow: 1,
                            mb: 0,
                            pr: 1,
                          }}
                        >
                          <Box sx={{ display: 'flex', alignItems: 'center', width: '100%' }}>
                            <ForumIcon sx={{ fontSize: 18, mr: 1.5, opacity: 0.7 }} />
                            <Box sx={{ 
                              flexGrow: 1, 
                              overflow: 'hidden', 
                              textOverflow: 'ellipsis', 
                              whiteSpace: 'nowrap'
                            }}>
                              {meeting.title}
                            </Box>
                          </Box>
                        </NavItem>
                        <IconButton 
                          size="small" 
                          sx={{ width: 28, height: 28, opacity: 0.6 }}
                          onClick={(e) => handleMenuOpen(e, meeting)}
                        >
                          <MoreVertIcon fontSize="small" />
                        </IconButton>
                      </Box>
                    ))}
                  </Box>
                ))}
              </Box>
            </Box>
          </Box>
          
          {/* User profile at bottom */}
          <Box sx={{ mt: 'auto', pt: 2, borderTop: '1px solid rgba(0,0,0,0.08)' }}>
            {currentUser && (
              <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                <Box sx={{ display: 'flex', alignItems: 'center' }}>
                  <Avatar 
                    src={currentUser.photoURL} 
                    alt={currentUser.displayName} 
                    sx={{ width: 32, height: 32 }}
                  />
                  <Typography variant="body2" sx={{ ml: 1, fontWeight: 500 }}>
                    {currentUser.displayName || 'User'}
                  </Typography>
                </Box>
                <Tooltip title="Logout">
                  <IconButton size="small" onClick={handleLogout}>
                    <LogoutIcon fontSize="small" />
                  </IconButton>
                </Tooltip>
              </Box>
            )}
          </Box>
        </Sidebar>
      </Drawer>
      
      {/* Main Content */}
      <Box sx={{ 
        flexGrow: 1, 
        ml: sidebarOpen ? '280px' : 0,
        transition: (theme) => theme.transitions.create('margin', {
          easing: theme.transitions.easing.sharp,
          duration: theme.transitions.duration.enteringScreen,
        }),
      }}>
        {/* Header App Bar */}
        <StyledAppBar position="static" sidebarOpen={sidebarOpen}>
          <Toolbar>
            <IconButton
              edge="start"
              color="inherit"
              aria-label="toggle sidebar"
              onClick={toggleSidebar}
              sx={{ mr: 2 }}
            >
              <MenuIcon />
            </IconButton>
            <Box sx={{ display: 'flex', alignItems: 'center', flexGrow: 1 }}>
              <Typography variant="h6" fontWeight="bold">
                My Meetings
              </Typography>
            </Box>
            
            <Box sx={{ display: 'flex', alignItems: 'center' }}>
              <IconButton size="small" color="inherit" sx={{ mr: 1 }}>
                <HelpOutlineIcon fontSize="small" />
              </IconButton>
              <IconButton size="small" color="inherit">
                <AutorenewIcon fontSize="small" />
              </IconButton>
            </Box>
          </Toolbar>
          
          <Box sx={{ px: 2, pt: 1, pb: 2 }}>
            <Typography variant="body2" color="text.secondary">
              Improve Your Second Brain & Focus with TwinMind
            </Typography>
            <Typography variant="h6" fontWeight="bold" sx={{ mb: 1 }}>
              Building Your Second Brain
            </Typography>
            <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
              <Avatar sx={{ width: 24, height: 24, mr: 1 }} src={currentUser?.photoURL} />
              {profileData ? 
                <Typography variant="caption" color="text.secondary">
                  {profileData.user.name || currentUser.displayName} • 10/15 Notes
                </Typography>
               : 
                <Typography variant="caption" color="text.secondary">
                  {currentUser?.displayName} • Getting Started
                </Typography>
              }
            </Box>
          </Box>
          
          {/* Tab Navigation */}
          <Tabs 
            value={tabValue} 
            onChange={handleTabChange}
            variant="fullWidth" 
            sx={{ 
              '& .MuiTab-root': {
                minWidth: 'auto',
                fontSize: '0.85rem',
                fontWeight: 500,
                textTransform: 'none',
                py: 1.5
              } 
            }}
          >
            <Tab label="Memories" />
            <Tab label="Calendar" />
          </Tabs>
        </StyledAppBar>

        {/* Tab Content Panels */}
        <TabPanel hidden={tabValue !== 0} value={tabValue} index={0}>
          <Box sx={{ px: 2, py: 1 }}>
            <Typography variant="body2" color="text.secondary" sx={{ mb: 1 }}>
              Today, May 18
            </Typography>
              {/* Meeting Cards */}
            {meetings.length === 0 ? (
              <Box sx={{ 
                display: 'flex', 
                flexDirection: 'column', 
                alignItems: 'center', 
                justifyContent: 'center',
                mt: 4,
                mb: 6,
                height: '30vh' 
              }}>
                <Typography variant="body1" color="text.secondary" align="center" sx={{ mb: 2 }}>
                  No memories yet. Create your first one!
                </Typography>
                <img 
                  src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xOSA4QzIwLjY1NjkgOCAyMiA2LjY1Njg1IDIyIDVDMjIgMy4zNDMxNSAyMC42NTY5IDIgMTkgMkMxNy4zNDMxIDIgMTYgMy4zNDMxNSAxNiA1QzE2IDYuNjU2ODUgMTcuMzQzMSA4IDE5IDhaIiBzdHJva2U9IiMxRTYyRUIiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PHBhdGggZD0iTTE5IDE2QzIwLjY1NjkgMTYgMjIgMTQuNjU2OSAyMiAxM0MyMiAxMS4zNDMxIDIwLjY1NjkgMTAgMTkgMTBDMTcuMzQzMSAxMCAxNiAxMS4zNDMxIDE2IDEzQzE2IDE0LjY1NjkgMTcuMzQzMSAxNiAxOSAxNloiIHN0cm9rZT0iI0ZGOTgwMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48cGF0aCBkPSJNMTIgMTZDMTMuNjU2OSAxNiAxNSAxNC42NTY5IDE1IDEzQzE1IDExLjM0MzEgMTMuNjU2OSAxMCAxMiAxM0MwLjM0MzE1IDE4IDkgMTEuMzg0MzEgOSAxM0M5IDE0LjY1NjkgMTAuMzQzMSAxNiAxMiAxNloiIHN0cm9rZT0iIzFFNjJFQiIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48cGF0aCBkPSJNNSA4QzYuNjU2ODUgOCA4IDYuNjU2ODUgOCA1QzggMy4zNDMxNSA2LjY1Njg1IDIgNSAyQzMuMzQzMTUgMiAyIDMuMzQzMTUgMiA1QzIgNi42NTY4NSAzLjM0MzE1IDggNSA4WiIgc3Ryb2tlPSIjRkY5ODAwIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==" 
                  alt="No memories" 
                  style={{ width: 80, height: 80, opacity: 0.6, marginBottom: '16px' }} 
                />
              </Box>
            ) : (
              // Map through meetings
              meetings.map((meeting) => (
                <MeetingCard 
                  key={meeting.id}
                  onClick={() => navigate(`/transcription/${meeting.id}`)}
                  sx={{ cursor: 'pointer' }}
                >
                  <CardContent sx={{ pb: 2, '&:last-child': { pb: 2 } }}>
                    <Box sx={{ display: 'flex' }}>
                      <Box sx={{ mr: 2, width: 50, textAlign: 'center' }}>
                        <MeetingTime>{meeting.time}</MeetingTime>
                        <MeetingTime>am</MeetingTime>
                      </Box>
                      <Box sx={{ flexGrow: 1 }}>
                        <Typography variant="subtitle1" sx={{ fontSize: '0.9rem', fontWeight: 600, mb: 0.5 }}>
                          {meeting.title}
                        </Typography>
                        <Typography variant="body2" color="text.secondary" sx={{ fontSize: '0.8rem', mb: 0.5 }}>
                          {meeting.subtitle}
                        </Typography>
                        <Box sx={{ display: 'flex', alignItems: 'center' }}>
                          <Avatar sx={{ width: 20, height: 20, bgcolor: 'primary.main', fontSize: '0.7rem' }}>
                            {meeting.participants}
                          </Avatar>
                          <Typography variant="caption" color="text.secondary" sx={{ ml: 1 }}>
                            {meeting.time} - {meeting.endTime}
                          </Typography>
                        </Box>
                      </Box>
                    </Box>
                  </CardContent>
                </MeetingCard>
              ))
            )}
              <Box sx={{ display: 'flex', justifyContent: 'center', mt: 3 }}>
              <Button
                variant="outlined"
                startIcon={<SearchIcon fontSize="small" />}
                sx={{ 
                  mr: 1, 
                  borderRadius: '20px', 
                  fontSize: '0.8rem',
                  color: 'text.secondary',
                  borderColor: 'divider',
                  textTransform: 'none',
                  py: 1
                }}
              >
                Ask All Memories
              </Button>
              
              <CaptureButton
                variant="contained"
                color="primary"
                startIcon={<MicIcon fontSize="small" />}
                sx={{ fontSize: '0.8rem', py: 1 }}
                onClick={() => navigate('/transcription')}
              >
                Capture
              </CaptureButton>
            </Box>
          </Box>
        </TabPanel>
        
        <TabPanel hidden={tabValue !== 1} value={tabValue} index={1}>
          <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '200px' }}>
            <Typography color="text.secondary">Calendar view will be implemented soon</Typography>
          </Box>
        </TabPanel>
      </Box>
      
      {/* Error Alert for general errors */}
      {error && (
        <Alert 
          severity="warning"
          sx={{
            position: 'fixed',
            bottom: 16,
            right: 16,
            maxWidth: '400px',
            zIndex: 2000,
            boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
          }}
          onClose={() => setError('')}
        >
          {error}
        </Alert>
      )}
      
      {/* Context Menu for Meeting Items */}
      <Menu
        anchorEl={menuAnchorEl}
        open={Boolean(menuAnchorEl)}
        onClose={handleMenuClose}
        PaperProps={{
          elevation: 2,
          sx: {
            borderRadius: 2,
            minWidth: 180,
          }
        }}
      >
        {activeItem && (
          <>
            <MenuItem dense onClick={() => {
              toggleFavorite(activeItem);
              handleMenuClose();
            }}>
              {favorites.some(fav => fav.id === activeItem?.id) ? (
                <>
                  <ListItemIcon>
                    <StarIcon fontSize="small" sx={{ color: '#bbb' }} />
                  </ListItemIcon>
                  <ListItemText>Remove from favorites</ListItemText>
                </>
              ) : (
                <>
                  <ListItemIcon>
                    <StarIcon fontSize="small" sx={{ color: '#F9A825' }} />
                  </ListItemIcon>
                  <ListItemText>Add to favorites</ListItemText>
                </>
              )}
            </MenuItem>
            <MenuItem dense onClick={handleMenuClose}>
              <ListItemIcon>
                <InfoOutlinedIcon fontSize="small" />
              </ListItemIcon>
              <ListItemText>View details</ListItemText>
            </MenuItem>
          </>
        )}
      </Menu>
    </Box>
  );
};

export default Dashboard;
